"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("dotenv/config");
const core_1 = require("@nestjs/core");
const app_module_1 = require("./app.module");
const init_database_1 = require("./database/init-database");
async function bootstrap() {
    try {
        console.log('üöÄ Starting Olivia Backend...');
        console.log('üìä Environment:', process.env.NODE_ENV || 'development');
        console.log('üîß Port from env:', process.env.PORT);
        const app = await core_1.NestFactory.create(app_module_1.AppModule);
        console.log('‚úÖ NestJS app created successfully');
        console.log('üîç Initializing database with DatabaseInitializer...');
        try {
            const dataSource = app.get('DataSource');
            const dbInitializer = new init_database_1.DatabaseInitializer(dataSource);
            const timeout = setTimeout(() => {
                console.log('‚ö†Ô∏è Database initialization timeout, continuing...');
            }, 30000);
            await dbInitializer.initialize();
            clearTimeout(timeout);
            console.log('‚úÖ Database initialized successfully with DatabaseInitializer');
        }
        catch (error) {
            console.log('‚ö†Ô∏è Database initialization failed, but continuing...');
            console.log('‚ö†Ô∏è Error:', error.message);
        }
        app.enableCors({
            origin: [
                'https://olivia-cafeteria.vercel.app',
                'https://olivia-cafeteria-git-main-paulaferreyra.vercel.app',
                'https://olivia-cafeteria-git-main-p4ul4fs-projects.vercel.app',
                'https://olivia-cafeteria-nxsxfbmd9-p4ul4fs-projects.vercel.app',
                'http://localhost:3000',
                'http://localhost:3001',
            ],
            credentials: true,
            methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],
            allowedHeaders: ['Content-Type', 'Authorization', 'Accept'],
        });
        console.log('‚úÖ CORS configured for Vercel domains');
        const port = process.env.PORT || 3001;
        console.log('üéØ Attempting to listen on port:', port);
        await app.listen(port, '0.0.0.0');
        console.log(`‚úÖ Backend running on port ${port}`);
        console.log(`üîó Healthcheck URL: http://0.0.0.0:${port}/health`);
        console.log('üéâ Application started successfully!');
    }
    catch (error) {
        console.error('‚ùå Failed to start application:', error);
        console.error('‚ùå Error stack:', error.stack);
        process.exit(1);
    }
}
bootstrap();
//# sourceMappingURL=main.js.map